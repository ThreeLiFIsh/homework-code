<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¤§é›å¡”ä¸ªæ€§åŒ–å¯¼è§ˆæ¨èç³»ç»Ÿ</title>
    <!-- å¼•å…¥PyScriptæ ¸å¿ƒåº“ -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <!-- é…ç½®Pythonä¾èµ– -->
    <py-config>
        packages = ["networkx", "matplotlib"]
    </py-config>
    <style>
        body {
            font-family: "SimHei", sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .left-panel {
            width: 30%;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .right-panel {
            width: 70%;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .title {
            text-align: center;
            color: #1890ff;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .sub-title {
            color: #2f5496;
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .info-item {
            margin: 10px 0;
            font-size: 16px;
        }
        .tip-box {
            background-color: #e6f7ff;
            padding: 10px;
            border-left: 4px solid #1890ff;
            margin: 10px 0;
            border-radius: 4px;
        }
        select {
            width: 100%;
            padding: 8px;
            font-size: 16px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #d9d9d9;
        }
    </style>
</head>
<body>
    <div class="title">ğŸ—¼ å¤§é›å¡”ä¸ªæ€§åŒ–å¯¼è§ˆæ¨èç³»ç»Ÿ</div>
    
    <div class="container">
        <!-- å·¦ä¾§ï¼šåŸºç¡€ä¿¡æ¯ + é€‰æ‹©æ ‡ç­¾ -->
        <div class="left-panel">
            <div class="sub-title">ğŸ“œ å¤§é›å¡”åŸºç¡€ä¿¡æ¯</div>
            <div id="basic-info" class="info-item"></div>
            
            <hr>
            
            <div class="sub-title">ğŸ¯ é€‰æ‹©ä½ çš„å…´è¶£æ ‡ç­¾</div>
            <select id="tag-select" onchange="updateGuide()">
                <option value="å†å²çˆ±å¥½è€…">å†å²çˆ±å¥½è€…</option>
                <option value="æ‘„å½±çˆ±å¥½è€…">æ‘„å½±çˆ±å¥½è€…</option>
                <option value="ç¾é£Ÿå®¶">ç¾é£Ÿå®¶</option>
            </select>
        </div>
        
        <!-- å³ä¾§ï¼šä¸ªæ€§åŒ–æ–¹æ¡ˆ + è·¯çº¿å›¾ -->
        <div class="right-panel">
            <div class="sub-title" id="plan-title">âœ¨ å†å²çˆ±å¥½è€…ä¸“å±å‚è§‚æ–¹æ¡ˆ</div>
            
            <div class="sub-title">ğŸ“Œ æ ¸å¿ƒå‚è§‚é‡ç‚¹</div>
            <div id="focus-list" class="info-item"></div>
            
            <div class="sub-title">ğŸ—ºï¸ æ¨èå‚è§‚è·¯çº¿</div>
            <div id="route-list" class="info-item"></div>
            
            <div id="tips-box"></div>
            
            <hr>
            
            <div class="sub-title">ğŸ–¼ï¸ å‚è§‚è·¯çº¿å¯è§†åŒ–</div>
            <div id="route-plot"></div>
        </div>
    </div>

    <py-script>
import matplotlib.pyplot as plt
import networkx as nx
from pyodide.ffi import create_proxy, to_js
import js

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei', 'DejaVu Sans']
plt.rcParams['axes.unicode_minus'] = False

# å®šä¹‰åŸºç¡€æ•°æ®
pagoda_info = {
    "åç§°": "å¤§é›å¡”ï¼ˆGiant Wild Goose Pagodaï¼‰",
    "ä½ç½®": "è¥¿å®‰å¤§æ…ˆæ©å¯ºå†…",
    "å»ºé€ æ—¶é—´": "å”æ°¸å¾½ä¸‰å¹´ï¼ˆ652å¹´ï¼‰",
    "é«˜åº¦": "64.517ç±³",
    "å±‚æ•°": 7,
    "è£èª‰": ["å…¨å›½é‡ç‚¹æ–‡ç‰©ä¿æŠ¤å•ä½", "ä¸ç»¸ä¹‹è·¯ä¸–ç•Œæ–‡åŒ–é—äº§"]
}

personalized_plans = {
    "å†å²çˆ±å¥½è€…": {
        "focus": [
            "ç„å¥˜è¥¿è¡Œå–ç»å†ç¨‹ä¸å»ºå¡”èƒŒæ™¯",
            "ã€Šå¤§å”ä¸‰è—åœ£æ•™åºç¢‘ã€‹çš„ä¹¦æ³•ä¸å²æ–™ä»·å€¼",
            "å¤§æ…ˆæ©å¯ºä¸å”ä»£é•¿å®‰åŸçš„åœ°ç†å…³è”"
        ],
        "route": [
            "å¤§é›å¡”åŒ—å¹¿åœºï¼ˆå”ä»£é›•å¡‘ç¾¤ï¼‰",
            "å¤§æ…ˆæ©å¯ºå±±é—¨ï¼ˆå”ä»£å¯ºåº™å»ºåˆ¶ï¼‰",
            "å¤§é›å¡”åº•å±‚ï¼ˆç¢‘åˆ»ã€ç„å¥˜è¯‘ç»å ‚ï¼‰",
            "å¤§é›å¡”ç™»å¡”ï¼ˆä¿¯ç°å”ä»£é•¿å®‰é—å€æ–¹å‘ï¼‰",
            "æ…ˆæ©å¯ºåšç‰©é¦†ï¼ˆå”ä»£ä½›æ•™æ–‡ç‰©ï¼‰"
        ]
    },
    "æ‘„å½±çˆ±å¥½è€…": {
        "focus": [
            "ä¸åŒå…‰çº¿ï¼ˆæ¸…æ™¨/å‚æ™š/å¤œæ™šï¼‰ä¸‹çš„å¡”èº«çº¿æ¡",
            "çº¢å¢™ã€å¤æ§ã€é“¶æä¸å¡”èº«çš„å±‚æ¬¡æ­é…",
            "éŸ³ä¹å–·æ³‰ç¯å…‰ç§€ä¸å¤å»ºçš„å¤ä»Šèåˆ"
        ],
        "route": [
            "å¤§é›å¡”å—å¹¿åœºï¼ˆç„å¥˜é›•åƒä¸ºå‰æ™¯æ‹å…¨æ™¯ï¼‰",
            "æ…ˆæ©å¯ºä¸œä¾§é“¶æé“ï¼ˆç§‹å­£é‡‘é»„æ ‘å¶æ­é…ï¼‰",
            "å¤§é›å¡”è¥¿ä¾§å°é˜¶ï¼ˆä½è§’åº¦ä»°æ‹ï¼‰",
            "å¤§é›å¡”åŒ—å¹¿åœºï¼ˆå–·æ³‰ä¸å¡”èº«è”åŠ¨ï¼‰",
            "å¤§æ‚¦åŸè§‚æ™¯å°ï¼ˆé«˜ç©ºä¿¯æ‹åŸå¸‚ä¸å¤å¡”ï¼‰"
        ],
        "tips": "ç§‹å­£10-11æœˆæ‹æ‘„æœ€ä½³ï¼Œå»ºè®®æºå¸¦å¹¿è§’+é•¿ç„¦é•œå¤´"
    },
    "ç¾é£Ÿå®¶": {
        "focus": [
            "å”ä»£ç´ æ–‹æ–‡åŒ–ä¼ æ‰¿",
            "é•¿å®‰ä¼ ç»Ÿå°åƒçš„å†å²å…¸æ•…",
            "å¸‚äº•å¤œå¸‚çš„åœ°é“çƒŸç«æ°”"
        ],
        "route": [
            "å¤§æ…ˆæ©å¯ºç´ æ–‹é¦†ï¼ˆä½›ç³»ç´ é¢ã€ç´ åŒ…ï¼‰",
            "å¤§å”ä¸å¤œåŸç¾é£Ÿè¡—ï¼ˆè‘«èŠ¦é¸¡ã€ç”‘ç³•ã€biangbiangé¢ï¼‰",
            "æ›²æ±Ÿå¤§æ‚¦åŸï¼ˆé™•æ´¾åˆ›æ„èœï¼‰",
            "æ…ˆæ©è·¯å¤œå¸‚ï¼ˆçƒ¤é¢ç­‹ã€é†ªç³Ÿæ±¤åœ†ï¼‰"
        ]
    }
}

# åˆå§‹åŒ–åŸºç¡€ä¿¡æ¯
def init_basic_info():
    info_html = ""
    for key, value in pagoda_info.items():
        if isinstance(value, list):
            info_html += f"<p><strong>{key}ï¼š</strong>{', '.join(value)}</p>"
        else:
            info_html += f"<p><strong>{key}ï¼š</strong>{value}</p>"
    js.document.getElementById("basic-info").innerHTML = info_html

# ç»˜åˆ¶è·¯çº¿å›¾
def plot_route(route, tag):
    # æ¸…ç©ºä¹‹å‰çš„å›¾è¡¨
    js.document.getElementById("route-plot").innerHTML = ""
    
    # åˆ›å»ºæœ‰å‘å›¾
    G = nx.DiGraph()
    for i in range(len(route)):
        node_name = f"{i+1}.\n{route[i]}" if len(route[i]) > 10 else f"{i+1}. {route[i]}"
        G.add_node(i, label=node_name)
        if i > 0:
            G.add_edge(i - 1, i)
    
    pos = {i: (i, 0) for i in range(len(route))}
    fig, ax = plt.subplots(figsize=(12, 4))
    
    nx.draw(G, pos, node_size=5000, node_color="#e6f7ff", edge_color="#1890ff",
            width=2, arrowstyle="->", arrowsize=15, with_labels=False, ax=ax)
    labels = {i: G.nodes[i]['label'] for i in G.nodes}
    nx.draw_networkx_labels(G, pos, labels, font_size=8, font_weight="bold", ax=ax)
    
    ax.set_title(f"å¤§é›å¡”ã€{tag}ã€‘å‚è§‚è·¯çº¿å›¾", fontsize=14, fontweight="bold")
    ax.axis("off")
    
    # æ¸²æŸ“åˆ°ç½‘é¡µ
    fig.canvas.draw()
    img_data = fig.canvas.tostring_base64()
    img_html = f'<img src="data:image/png;base64,{img_data}" width="100%"/>'
    js.document.getElementById("route-plot").innerHTML = img_html

# æ›´æ–°å¯¼è§ˆæ–¹æ¡ˆ
def update_guide(event=None):
    # è·å–é€‰ä¸­çš„æ ‡ç­¾
    tag = js.document.getElementById("tag-select").value
    
    # æ›´æ–°æ ‡é¢˜
    js.document.getElementById("plan-title").innerHTML = f"âœ¨ {tag}ä¸“å±å‚è§‚æ–¹æ¡ˆ"
    
    # è·å–å¯¹åº”æ–¹æ¡ˆ
    plan = personalized_plans[tag]
    
    # æ›´æ–°æ ¸å¿ƒé‡ç‚¹
    focus_html = ""
    for idx, item in enumerate(plan["focus"], 1):
        focus_html += f"<p>{idx}. {item}</p>"
    js.document.getElementById("focus-list").innerHTML = focus_html
    
    # æ›´æ–°è·¯çº¿
    route_html = ""
    for idx, spot in enumerate(plan["route"], 1):
        route_html += f"<p>{idx}. {spot}</p>"
    js.document.getElementById("route-list").innerHTML = route_html
    
    # æ›´æ–°å°è´´å£«
    tips_box = js.document.getElementById("tips-box")
    if "tips" in plan:
        tips_html = f'<div class="sub-title">ğŸ’¡ å°è´´å£«</div><div class="tip-box">{plan["tips"]}</div>'
        tips_box.innerHTML = tips_html
    else:
        tips_box.innerHTML = ""
    
    # ç»˜åˆ¶è·¯çº¿å›¾
    plot_route(plan["route"], tag)

# åˆå§‹åŒ–
init_basic_info()
update_guide()

# ç»‘å®šå‰ç«¯äº‹ä»¶
update_guide_proxy = create_proxy(update_guide)
js.window.updateGuide = update_guide_proxy
    </py-script>
</body>
</html>