# å¤§é›å¡”ä¸ªæ€§åŒ–å¯¼è§ˆæ¨èç³»ç»Ÿ
import time
import os
import matplotlib.pyplot as plt
import networkx as nx

# è®¾ç½®ä¸­æ–‡å­—ä½“ï¼ˆè§£å†³matplotlibä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ï¼‰
plt.rcParams['font.sans-serif'] = ['SimHei']  # é»‘ä½“
plt.rcParams['axes.unicode_minus'] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜


# å®šä¹‰æ¸…å±å‡½æ•°ï¼ˆé€‚é…ä¸åŒç³»ç»Ÿï¼‰
def clear_screen():
    os.system('cls' if os.name == 'nt' else 'clear')


# å®šä¹‰å¤§é›å¡”åŸºç¡€ä¿¡æ¯
pagoda_info = {
    "name": "å¤§é›å¡”ï¼ˆGiant Wild Goose Pagodaï¼‰",
    "location": "è¥¿å®‰å¤§æ…ˆæ©å¯ºå†…",
    "built_time": "å”æ°¸å¾½ä¸‰å¹´ï¼ˆ652å¹´ï¼‰",
    "height": "64.517ç±³",
    "layers": 7,
    "honor": ["å…¨å›½é‡ç‚¹æ–‡ç‰©ä¿æŠ¤å•ä½", "ä¸ç»¸ä¹‹è·¯ä¸–ç•Œæ–‡åŒ–é—äº§"]
}

# å®šä¹‰ä¸åŒå…´è¶£æ ‡ç­¾çš„ä¸ªæ€§åŒ–æ–¹æ¡ˆ
personalized_plans = {
    "å†å²çˆ±å¥½è€…": {
        "focus": [
            "ç„å¥˜è¥¿è¡Œå–ç»å†ç¨‹ä¸å»ºå¡”èƒŒæ™¯",
            "ã€Šå¤§å”ä¸‰è—åœ£æ•™åºç¢‘ã€‹çš„ä¹¦æ³•ä¸å²æ–™ä»·å€¼",
            "å¤§æ…ˆæ©å¯ºä¸å”ä»£é•¿å®‰åŸçš„åœ°ç†å…³è”"
        ],
        "route": [
            "å¤§é›å¡”åŒ—å¹¿åœºï¼ˆå”ä»£é›•å¡‘ç¾¤ï¼‰",
            "å¤§æ…ˆæ©å¯ºå±±é—¨ï¼ˆå”ä»£å¯ºåº™å»ºåˆ¶ï¼‰",
            "å¤§é›å¡”åº•å±‚ï¼ˆç¢‘åˆ»ã€ç„å¥˜è¯‘ç»å ‚ï¼‰",
            "å¤§é›å¡”ç™»å¡”ï¼ˆä¿¯ç°å”ä»£é•¿å®‰é—å€æ–¹å‘ï¼‰",
            "æ…ˆæ©å¯ºåšç‰©é¦†ï¼ˆå”ä»£ä½›æ•™æ–‡ç‰©ï¼‰"
        ]
    },
    "æ‘„å½±çˆ±å¥½è€…": {
        "focus": [
            "ä¸åŒå…‰çº¿ï¼ˆæ¸…æ™¨/å‚æ™š/å¤œæ™šï¼‰ä¸‹çš„å¡”èº«çº¿æ¡",
            "çº¢å¢™ã€å¤æ§ã€é“¶æä¸å¡”èº«çš„å±‚æ¬¡æ­é…",
            "éŸ³ä¹å–·æ³‰ç¯å…‰ç§€ä¸å¤å»ºçš„å¤ä»Šèåˆ"
        ],
        "route": [
            "å¤§é›å¡”å—å¹¿åœºï¼ˆç„å¥˜é›•åƒä¸ºå‰æ™¯æ‹å…¨æ™¯ï¼‰",
            "æ…ˆæ©å¯ºä¸œä¾§é“¶æé“ï¼ˆç§‹å­£é‡‘é»„æ ‘å¶æ­é…ï¼‰",
            "å¤§é›å¡”è¥¿ä¾§å°é˜¶ï¼ˆä½è§’åº¦ä»°æ‹ï¼‰",
            "å¤§é›å¡”åŒ—å¹¿åœºï¼ˆå–·æ³‰ä¸å¡”èº«è”åŠ¨ï¼‰",
            "å¤§æ‚¦åŸè§‚æ™¯å°ï¼ˆé«˜ç©ºä¿¯æ‹åŸå¸‚ä¸å¤å¡”ï¼‰"
        ],
        "tips": "ç§‹å­£10-11æœˆæ‹æ‘„æœ€ä½³ï¼Œå»ºè®®æºå¸¦å¹¿è§’+é•¿ç„¦é•œå¤´"
    },
    "ç¾é£Ÿå®¶": {
        "focus": [
            "å”ä»£ç´ æ–‹æ–‡åŒ–ä¼ æ‰¿",
            "é•¿å®‰ä¼ ç»Ÿå°åƒçš„å†å²å…¸æ•…",
            "å¸‚äº•å¤œå¸‚çš„åœ°é“çƒŸç«æ°”"
        ],
        "route": [
            "å¤§æ…ˆæ©å¯ºç´ æ–‹é¦†ï¼ˆä½›ç³»ç´ é¢ã€ç´ åŒ…ï¼‰",
            "å¤§å”ä¸å¤œåŸç¾é£Ÿè¡—ï¼ˆè‘«èŠ¦é¸¡ã€ç”‘ç³•ã€biangbiangé¢ï¼‰",
            "æ›²æ±Ÿå¤§æ‚¦åŸï¼ˆé™•æ´¾åˆ›æ„èœï¼‰",
            "æ…ˆæ©è·¯å¤œå¸‚ï¼ˆçƒ¤é¢ç­‹ã€é†ªç³Ÿæ±¤åœ†ï¼‰"
        ]
    }
}


# å®šä¹‰åŸºç¡€ä¿¡æ¯å±•ç¤ºå‡½æ•°
def show_basic_info():
    """å±•ç¤ºå¤§é›å¡”åŸºç¡€ä¿¡æ¯"""
    print("=" * 60)
    print("ğŸ“œ å¤§é›å¡”åŸºç¡€ä¿¡æ¯".center(60))
    print("=" * 60)
    for key, value in pagoda_info.items():
        if isinstance(value, list):
            # å¤„ç†è£èª‰åˆ—è¡¨
            print(f"{key}ï¼š{', '.join(value)}")
        else:
            print(f"{key}ï¼š{value}")
    print("=" * 60)
    time.sleep(2)  # æš‚åœ2ç§’ï¼Œæ–¹ä¾¿è§‚çœ‹


# å®šä¹‰è·¯çº¿å¯è§†åŒ–å‡½æ•°
def plot_route(route, tag):
    """ç»˜åˆ¶å‚è§‚è·¯çº¿æµç¨‹å›¾"""
    # åˆ›å»ºæœ‰å‘å›¾
    G = nx.DiGraph()

    # æ·»åŠ èŠ‚ç‚¹å’Œè¾¹ï¼ˆæŒ‰è·¯çº¿é¡ºåºè¿æ¥ï¼‰
    for i in range(len(route)):
        # ç®€åŒ–èŠ‚ç‚¹åç§°ï¼ˆé¿å…è¿‡é•¿ï¼‰
        node_name = f"{i + 1}. {route[i][:8]}..." if len(route[i]) > 8 else f"{i + 1}. {route[i]}"
        G.add_node(i, label=node_name)
        if i > 0:
            G.add_edge(i - 1, i)

    # è®¾ç½®å¸ƒå±€ï¼ˆæ°´å¹³æ’åˆ—ï¼Œç¬¦åˆè·¯çº¿é¡ºåºï¼‰
    pos = {i: (i, 0) for i in range(len(route))}

    # åˆ›å»ºç”»å¸ƒ
    plt.figure(figsize=(12, 4))

    # ç»˜åˆ¶èŠ‚ç‚¹å’Œè¾¹
    nx.draw(G, pos,
            node_size=3000,
            node_color="#e6f7ff",
            edge_color="#1890ff",
            width=2,
            arrowstyle="->",
            arrowsize=15,
            with_labels=False)  # å…ˆä¸æ˜¾ç¤ºé»˜è®¤æ ‡ç­¾

    # æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆç®€åŒ–åçš„è·¯çº¿åç§°ï¼‰
    labels = {i: G.nodes[i]['label'] for i in G.nodes}
    nx.draw_networkx_labels(G, pos, labels, font_size=9, font_weight="bold")

    # è®¾ç½®æ ‡é¢˜å’Œæ ·å¼
    plt.title(f"å¤§é›å¡”ã€{tag}ã€‘å‚è§‚è·¯çº¿å›¾", fontsize=14, fontweight="bold", pad=20)
    plt.axis("off")  # éšè—åæ ‡è½´
    plt.tight_layout()

    # æ˜¾ç¤ºå›¾ç‰‡
    plt.show()


# å®šä¹‰å¯¼è§ˆè¯ç”Ÿæˆå‡½æ•°
def generate_guide(tag):
    """æ ¹æ®å…´è¶£æ ‡ç­¾ç”Ÿæˆä¸ªæ€§åŒ–å¯¼è§ˆæ¨è"""
    if tag not in personalized_plans:
        return f"âš ï¸ æš‚æœªæ”¶å½•{tag}çš„ç›¸å…³æ–¹æ¡ˆï¼Œè¯·é€‰æ‹©ï¼šå†å²çˆ±å¥½è€…/æ‘„å½±çˆ±å¥½è€…/ç¾é£Ÿå®¶", None

    plan = personalized_plans[tag]
    guide = f"\nğŸ¯ å¤§é›å¡”ã€{tag}ã€‘ä¸“å±å‚è§‚æ–¹æ¡ˆ\n"
    guide += "-" * 50 + "\n"

    # æ ¸å¿ƒé‡ç‚¹
    guide += "ğŸ“Œ æ ¸å¿ƒå‚è§‚é‡ç‚¹ï¼š\n"
    for idx, item in enumerate(plan["focus"], 1):
        guide += f"  {idx}. {item}\n"

    # æ¨èè·¯çº¿
    guide += "\nğŸ—ºï¸ æ¨èå‚è§‚è·¯çº¿ï¼š\n"
    for idx, spot in enumerate(plan["route"], 1):
        guide += f"  {idx}. {spot}\n"

    # å°è´´å£«ï¼ˆå¯é€‰ï¼‰
    if "tips" in plan:
        guide += "\nğŸ’¡ å°è´´å£«ï¼š\n"
        guide += f"  {plan['tips']}\n"

    guide += "-" * 50
    return guide, plan["route"]


# ä¸»ç¨‹åºï¼ˆæ‰‹åŠ¨è¾“å…¥äº¤äº’ï¼‰
if __name__ == "__main__":
    # å®‰è£…ä¾èµ–æç¤ºï¼ˆé¦–æ¬¡è¿è¡Œéœ€å®‰è£…ï¼‰
    print("ğŸ“¢ é¦–æ¬¡è¿è¡Œè¯·å…ˆå®‰è£…ä¾èµ–ï¼špip install matplotlib networkx")
    time.sleep(2)

    # æ¬¢è¿è¯­
    print("\nğŸŒŸ æ¬¢è¿ä½¿ç”¨è¥¿å®‰å¤§é›å¡”ä¸ªæ€§åŒ–å¯¼è§ˆæ¨èç³»ç»Ÿ ğŸŒŸ")
    time.sleep(1)

    # å±•ç¤ºåŸºç¡€ä¿¡æ¯
    clear_screen()
    show_basic_info()

    # æ ¸å¿ƒäº¤äº’ï¼šè¾“å…¥æ ‡ç­¾â†’è¾“å‡ºç»“æœ+ç»˜åˆ¶è·¯çº¿å›¾
    while True:
        print("\nğŸ“‹ å¯é€‰å…´è¶£æ ‡ç­¾ï¼šå†å²çˆ±å¥½è€…ã€æ‘„å½±çˆ±å¥½è€…ã€ç¾é£Ÿå®¶")
        user_tag = input("è¯·è¾“å…¥ä½ çš„å…´è¶£æ ‡ç­¾ï¼ˆè¾“å…¥'é€€å‡º'å¯ç»“æŸç¨‹åºï¼‰ï¼š").strip()

        # é€€å‡ºé€»è¾‘
        if user_tag == "é€€å‡º":
            print("ğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ï¼Œç¥æ‚¨æ¸¸è§ˆæ„‰å¿«ï¼")
            break

        # ç”Ÿæˆå¹¶å±•ç¤ºå¯¼è§ˆæ–¹æ¡ˆ
        clear_screen()
        guide_content, route = generate_guide(user_tag)
        print(guide_content)

        # å¦‚æœè·¯çº¿å­˜åœ¨ï¼Œç»˜åˆ¶å¯è§†åŒ–å›¾
        if route:
            print("\nğŸ–¼ï¸ æ­£åœ¨ç”Ÿæˆè·¯çº¿å¯è§†åŒ–å›¾...")
            time.sleep(1)
            plot_route(route, user_tag)

        # è¯¢é—®æ˜¯å¦ç»§ç»­
        continue_choice = input("\næ˜¯å¦æŸ¥çœ‹å…¶ä»–æ ‡ç­¾ï¼Ÿï¼ˆè¾“å…¥'y'ç»§ç»­ï¼Œå…¶ä»–é”®é€€å‡ºï¼‰ï¼š").strip().lower()
        if continue_choice != 'y':
            print("ğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨ï¼Œç¥æ‚¨æ¸¸è§ˆæ„‰å¿«ï¼")
            break
        clear_screen()